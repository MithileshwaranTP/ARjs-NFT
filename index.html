<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AR-JS Example</title>
  
  <!-- Include A-Frame library -->
  <script src="https://aframe.io/releases/1.0.4/aframe.min.js"></script>
  <script src='https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar-nft.js'></script>

  <!-- Include Paho MQTT library -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/paho-mqtt/1.0.2/mqttws31.min.js"></script>
</head>

<body style="margin: 0px; overflow: hidden;">
  <a-scene vr-mode-ui='enabled: true;' renderer="logarithmicDepthBuffer: true; precision: medium;" embedded arjs='trackingMethod: best; sourceType: webcam; debugUIEnabled: true;'>
  <!-- NFT marker setup -->
  <a-nft type='nft' url='pinball.jpg'
  smooth='true' smoothCount='10' smoothTolerance='0.01' smoothThreshold='5'>
      <!-- AR content to be displayed when the marker is detected -->
      <a-entity>
        <a-plane position="0 1 0" rotation="-90 0 0" width="2" height="2" color="#000000"></a-plane>
      </a-entity>
  </a-nft>
  <a-entity camera></a-entity>
</a-scene>

<script>
    const clientID = 'mqtt-explorer-3caa54bc';
    const host = 'localhost';   
    const port = 9001;  
    const client = new Paho.MQTT.Client(host, port, clientID);
    // Connect to the MQTT broker
    client.connect({
      onSuccess: function () {
      console.log("Connected to MQTT broker");
      // Subscribe to the MQTT topic
      client.subscribe('example');
      // Set up callback for incoming messages
      client.onMessageArrived = function (message) {
      // Update A-Frame entities based on MQTT data
      const mqttText = document.getElementById('mqttText');
      const displayText = 'MQTT Data: ' + message.payloadString;
      mqttText.setAttribute('text', 'value', displayText);
      mqttText.setAttribute('align', 'center');
      mqttText.setAttribute('scale', '0.7 0.7 0.7'); 
      }},
      onFailure: function (responseObject) {
        console.log("Failed to connect to MQTT broker: " + responseObject.errorMessage);
      }
    }); 
  </script>
</body>
</html>
